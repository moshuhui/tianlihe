var _LT_LocalSearchUrl="http://srvfree.api.51ditu.com/apisrv/ls?";if(!window.LTEvent){document.writeln('<script language="javascript" src="http://api.51ditu.com/js/ajax.js"></script>');};function LTNS(){LTNS.info={time:'Thu Jul 19 10:01:09 UTC+0800 2012',version:'1',ov:'1.3 Ver 20070705'};var w=function(g){var h=0,j=0;var k=g.length;var l=new String();var z=-1;var x=0;for(var c=0;c<k;c++){var v=g.charCodeAt(c);v=(v==95)?63:((v==44)?62:((v>=97)?(v-61):((v>=65)?(v-55):(v-48))));j=(j<<6)+v;h+=6;while(h>=8){var b=j>>(h-8);if(x>0){z=(z<<6)+(b&(0x3f));x--;if(x==0){l+=String.fromCharCode(z);};}else{if(b>=224){z=b&(0xf);x=2;}else if(b>=128){z=b&(0x1f);x=1;}else{l+=String.fromCharCode(b);};};j=j-(b<<(h-8));h-=8;};};return l;};var q=["(","),(","((",w("Q7HqS3elBtTtTourCMHfT7KkOszjBt0_QMGz"),"Error","Code","search2.5","loadstart",'&',"loaded",'radius=','pagecap=','start=','sortType=','showName=','areaNum=','mode=','modea=','words=',"POLYGON","",'area=CIRCLE(',"CIRCLE",',','area=RECT(',"RECT",')',' ','area=POINT(',"POINT","object",'area=',"string",'city='];var i=window;var o=document;function f(g,h){for(var j in h){g[j]=h[j];};}function a(f){var e=this;e.versions="search3.0";e.handle=f;e.modea=0;e.mode=0;e.areaNum=1;e.showName=1;e.sortType=0;e.pagecap=10;e.radius=5000;e.class1=-1;e.class2=-1;e.district1=-1;e.district2=-1;e.totalNumber=-1;e.RSMode=-1;e.start=1;};f(a.prototype,{searchBase3:function(){var e=this;var f=[];if(e.city){f.push(q[33]+encodeURIComponent(e.city));};if(e.area){if(e.areaType=="WORD"&&typeof(e.area)==q[32]){f.push(q[31]+encodeURIComponent(e.area));};if(typeof(e.area)==q[30]){if(e.area.getLongitude&&e.areaType==q[29]){f.push(q[28]+e.area.getLongitude()+q[27]+e.area.getLatitude()+q[26]);}else if(e.area.length==2&&e.areaType==q[29]){f.push(q[28]+e.area[0]+q[27]+e.area[1]+q[26]);}else if(e.area.getXmin&&e.areaType==q[25]){f.push(q[24]+e.area.getXmin()+q[27]+e.area.getYmax()+q[23]+e.area.getXmax()+q[27]+e.area.getYmin()+q[26]);}else if(e.area.length==4&&e.areaType==q[25]){f.push(q[24]+e.area[0]+q[27]+e.area[3]+q[23]+e.area[2]+q[27]+e.area[1]+q[26]);}else if(e.area.length==2&&e.areaType==q[22]){f.push(q[21]+e.area[0]+q[27]+e.area[1]+q[23]+e.radiusCircle+q[26]);}else if(e.area.getLongitude&&e.areaType==q[22]){f.push(q[21]+e.area.getLongitude()+q[27]+e.area.getLatitude()+q[23]+e.radiusCircle+q[26]);}else if(e.area.length>1&&e.areaType=="LINESTRING"){var g=q[20];for(var h=0;h<e.area.length;h++){if(h!=e.area.length-1){g+=e.area[h].getLongitude()+q[27]+e.area[h].getLatitude()+q[23];}else{g+=e.area[h].getLongitude()+q[27]+e.area[h].getLatitude();};};var j="area=LINESTRING("+g+q[26];f.push(j);}else if(e.area.length>1&&e.areaType==q[19]){var k=q[20];for(var h=0;h<e.area.length;h++){if(h!=e.area.length-1){k+=e.area[h].getLongitude()+q[27]+e.area[h].getLatitude()+q[23];}else{k+=e.area[h].getLongitude()+q[27]+e.area[h].getLatitude();};};var l="area=POLYGON("+k+q[26];f.push(l);};};};if(e.words){f.push(q[18]+encodeURIComponent(e.words));};if(e.modea==1){f.push(q[17]+parseInt(e.modea));};if(e.mode==1){f.push(q[16]+parseInt(e.mode));};if(e.areaNum>0&&e.areaNum<=10){f.push(q[15]+parseInt(e.areaNum));};if(e.showName==1){f.push(q[14]+parseInt(e.showName));};if(e.sortType>0){f.push(q[13]+parseInt(e.sortType));};if(e.start>1){f.push(q[12]+parseInt(e.start));};if(e.pagecap>0&&e.pagecap<=100){f.push(q[11]+parseInt(e.pagecap));};if(e.radius>0&&e.areaType!=q[22]&&e.areaType!=q[25]&&e.areaType!=q[19]){f.push(q[10]+parseInt(e.radius));};if(e.class1!=-1&&e.class2!=-1){f.push('class='+e.class1+q[23]+e.class2);};if(e.district1!=-1&&e.district2!=-1){f.push('district='+e.district1+q[23]+e.district2);};if(e.RSMode!=-1){f.push('RSMode='+e.RSMode);};var z=LTObjectLoader.getObject();z.loadListener=LTEvent.bind(z,q[9],e,e.onResult);z.load(i._LT_LocalSearchUrl+f.join(q[8]));LTEvent.trigger(e,q[7]);},searchBase2:function(){var e=this;var f=[];if(e.city){f.push(q[33]+encodeURIComponent(e.city));};if(e.area){if(typeof(e.area)==q[32]){f.push(q[31]+encodeURIComponent(e.area));};if(typeof(e.area)==q[30]){if(e.area.getLongitude){f.push(q[28]+e.area.getLongitude()+q[27]+e.area.getLatitude()+q[26]);}else if(e.area.getXmin){e.areaType=q[25];f.push(q[24]+e.area.getXmin()+q[27]+e.area.getYmax()+q[23]+e.area.getXmax()+q[27]+e.area.getYmin()+q[26]);}else if(e.area.length==4){e.areaType=q[25];f.push(q[24]+e.area[0]+q[27]+e.area[3]+q[23]+e.area[2]+q[27]+e.area[1]+q[26]);}else if(e.area.length==2){f.push(q[28]+e.area[0]+q[27]+e.area[1]+q[26]);};};};if(e.words){f.push(q[18]+encodeURIComponent(e.words));};if(e.modea==1){f.push(q[17]+parseInt(e.modea));};if(e.mode==1){f.push(q[16]+parseInt(e.mode));};if(e.areaNum>0&&e.areaNum<=10){f.push(q[15]+parseInt(e.areaNum));};if(e.showName==1){f.push(q[14]+parseInt(e.showName));};if(e.sortType>0){f.push(q[13]+parseInt(e.sortType));};if(e.start>1){f.push(q[12]+parseInt(e.start));};if(e.pagecap>0&&e.pagecap<=100){f.push(q[11]+parseInt(e.pagecap));};if(e.radius>0&&e.areaType!=q[25]){f.push(q[10]+parseInt(e.radius));};if(e.class1!=-1&&e.class2!=-1){f.push('class1='+e.class1);f.push('class2='+e.class2);};if(e.district1!=-1&&e.district2!=-1){f.push('district1='+e.district1);f.push('district2='+e.district2);};var g=LTObjectLoader.getObject();g.loadListener=LTEvent.bind(g,q[9],e,e.onResult);g.load(i._LT_LocalSearchUrl+f.join(q[8]));LTEvent.trigger(e,q[7]);},search:function(f,g,h){var e=this;if(e.areaType){e.totalNumber=-1;e.searchBase3();}else{e.versions=q[6];e.area=g?g:null;e.words=f?f:null;e.start=(h&&h>0)?parseInt(h):1;e.totalNumber=-1;e.searchBase2();};},setWords:function(f){var e=this;e.words=f;},setArea:function(f){var e=this;e.area=f;if(e.areaType&&e.areaType==q[22]){e.radiusCircle=e.radius;};},setCirclerRadius:function(f){var e=this;e.radiusCircle=f;},setStartPage:function(f){var e=this;e.start=f;},setAreaType:function(f){var e=this;e.areaType=f;},setCity:function(f){var e=this;if(i.LTPlaceList){var g=i.LTPlaceList.getDefault();var h=g.search(function(j){j.getName()==f},1);if(h.length<1){h=g.searchPlace(f,1,null,function(j){return j.canLocalSearch()=="self"});if(h.length>0){f=h[0].getName();};};};e.city=f;},getTotalNumber:function(){var e=this;return e.totalNumber;},getTotalPage:function(){var e=this;return e.totalPage;},searchPage:function(f){var e=this;if(e.totalPage<=0||f<=0||f>e.totalPage){return false;};e.start=f;if(e.versions==q[6]){e.searchBase2();}else{e.searchBase3();};return true;},searchRadius:function(f){var e=this;e.radius=f;e.start=1;if(e.versions==q[6]){e.searchBase2();}else{e.searchBase3();};return true;},firstPage:function(){var e=this;return e.searchPage(1);},nextPage:function(){var e=this;return e.searchPage(e.start+1);},previousPage:function(){var e=this;return e.searchPage(e.start-1);},lastPage:function(){var e=this;return e.searchPage(e.totalPage);},onResult:function(f){var e=this;e.running=false;var g=new s(f,e);if(e.handle){e.handle.apply(null,[g]);};LTEvent.trigger(e,"loadend",[g]);}});function s(f,g){var e=this;e.time=-1;e.error=0;e.count=0;e.searchPoints=[];e.centerPoints=[];e.page=g.start;e.time=f.a.time;e.error=parseInt(f.a.error);switch(e.error){case 0:if(f.c[0]&&f.c[0].n=="Area"){var h=f.c[0].c;for(var j=0;j<h.length;j++){e.centerPoints.push(new d(h[j]));break;};};var k=LTObjectLoader.getChild(f,"Res");if(k){if(k.a.total){g.totalNumber=parseInt(k.a.total);g.totalPage=Math.ceil(g.totalNumber/g.pagecap);};for(var j=0;j<k.c.length;j++){e.addSearchPoint(new d(k.c[j]));};};break;case 1:e.errorCode=LTObjectLoader.getChild(f,q[5]);e.errorDescription=LTObjectLoader.getChild(f,q[4]);break;case 2:var l=LTObjectLoader.getChild(f,"Center");e.errorCode=LTObjectLoader.getChild(l,q[5]);e.errorDescription=LTObjectLoader.getChild(l,q[4]);case 3:var z=LTObjectLoader.getChild(f,"Word");e.errorCode=LTObjectLoader.getChild(z,q[5]);e.errorDescription=LTObjectLoader.getChild(z,q[4]);default:};};f(s.prototype,{getPageIndex:function(){var e=this;return e.page;},addSearchPoint:function(f){var e=this;e.searchPoints.push(f);e.count++;},getSearchPointsNumber:function(){var e=this;return e.count;}});function d(f){var e=this;e.id=f.a.id;e.point=null;for(var g=0;g<f.c.length;g++){var h=f.c[g];switch(h.n){case"Geo":e.point=[parseInt(h.a.lo),parseInt(h.a.la)];break;case"LSID":var j=h.a.v;e.url=q[3]+j.substring(j.lastIndexOf("/")+1);break;case"PoiID":var k=h.a.v;e.url=q[3]+k;break;case"Admin":e.admin=h.a;break;case"Class":e.cla=h.a;break;case"Des":e.description=h.t;break;case"WKT":e.wkt=h.a.v;e.wktPoints=[];if(h.a.v.indexOf(q[2])!=-1){var l=h.a.v.split(q[2]);var z=l[1].split("))")[0];if(z.indexOf(q[1])!=-1){var x=z.split(q[1]);for(var c=0;c<x.length;c++){var v=[];var b=x[c].split(q[23]);for(var n=0;n<b.length;n++){var m=b[n].split(q[27]);var _=new LTPoint(m[0],m[1]);v.push(_);};e.wktPoints.push(v);};};};if(h.a.v.indexOf(q[0])!=-1){var l=h.a.v.split(q[0]);var z=l[1].split(q[26])[0];var v=[];var x=z.split(q[23]);for(var c=0;c<x.length;c++){var m=x[c].split(q[27]);var _=new LTPoint(m[0],m[1]);v.push(_);};e.wktPoints.push(v);};break;default:e[h.n.toLowerCase()]=h.a.v;};e.telephone=e.tel;e.address=e.add;e.name=e.na;if(e.type){e.type=parseInt(e.type);};};};var p=function(a){var s=o.getElementsByTagName(w("SsDoQN1q"));var d=new RegExp(a,"i");for(var f=0;f<s.length;f++){var g=s[f];if(g.src&&d.test(g.src)){break;};};return!o.all||f<s.length;};if(!p(w("NbnpAYXeT7HmA3ywSoa_EYylAJyeFpfRN7TTArmkAIerCMHfT7LSBcDlRIzgSozpPM5oOsXSBcfpN7Cg90")))return false;f(i,{LTLocalSearch:a,LTLocalSearchResult:s,LTLocalSearchPoint:d})};LTNS();
